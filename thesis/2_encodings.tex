\newcommand{\white}{\fullmoon}
\newcommand{\black}{\newmoon}

\newcommand{\bigtimes}{\mathop{\raisebox{-0.5ex}{\scalebox{2}{$\times$}}}}

% https://texdoc.org/serve/chessboard/0
\newcounter{pieceindex}
\newcommand{\pieceBoard}{
    \newcount\pieceindex
    \setcounter{pieceindex}{0}
    \raisebox{-7ex}{
        \centering
        \chessboard[
            tinyboard,
            showmover=false,
            margin=false,
            padding=false,
            hlabel=false,
            vlabel=false,
            pgfstyle={text},
            %text=\fontsize{1.2ex}{1.2ex}\bfseries\sffamily \thepieceindex \stepcounter{pieceindex}, %  \currentwq
            text=\fontsize{1.2ex}{1.2ex}\bfseries\sffamily \currentwq,
            markboard
        ]
    }
}
\newcommand{\pieceRolesTable}{
    \begin{tabular}{|l|}
        \hline
        \sympawn\ Pawn \\
        \hline
        \symknight\ Knight \\
        \hline
        \symbishop\ Bishop \\
        \hline
        \symrook\ Rook \\
        \hline
        \symqueen\ Queen \\
        \hline
        \symking\ King \\
        \hline
    \end{tabular}
}
\newcommand{\pieceColorsTable}{
    \begin{tabular}{|l|}
        \hline
        $\white$ White \\
        \hline
        $\black$ Black \\
        \hline
    \end{tabular}
}

\newcommand{\fs}[1]{\textsc{#1}}


\section{Feature sets (board encodings)}

To evaluate a chess positions, we will use a neural network with an architecture explained in detail in the next chapter. In this chapter, we will build the input vector to such network, which can be described entirely by a feature set.

A feature set is a set built by a cartesian product of smaller sets of features, where each set extracts a different aspect of a position. Let's consider some basic sets of features.

The following sets encode positional information about the board:

\begin{center}
\begin{tabular}{cc}

$\begin{aligned}[t]
\fs{File} &= \{a, b, ..., h\} \\
\fs{Rank} &= \{1, 2, ..., 8\} \\
\fs{Square} &= \{a1, a2, ..., h8\}
\end{aligned}$

&

\raisebox{-10ex}{
\chessboard[
    tinyboard,
    showmover=false,
    pgfstyle={text},
    %text=\fontsize{1.2ex}{1.2ex}\bfseries\sffamily \thepieceindex \stepcounter{pieceindex}, %  \currentwq
    text=\fontsize{1.2ex}{1.2ex}\bfseries\sffamily \currentwq,
    markboard
]
}

\end{tabular}
\end{center}

That may or may not be related to a piece on the board.

.\\
.\\

\fs{Role} = \{
    \sympawn\ Pawn,
    \symknight\ Knight,
    \symbishop\ Bishop,
    \symrook\ Rook,
    \symqueen\ Queen,
    \symking\ King\}

\fs{Color} = \{$\white$ White, $\black$ Black\} \\

The input to the network is a one-dimensional vector with multi-hot encoding.


Since

Note that internally, \fs{Square} is stored as numbers 0 ... 63:

\pieceBoard â†’ \pieceBoard


For example for $(h8, \symrook, \black)$

file, color vs file, role

\subsection{\mdseries\fs{Piece}}

This feature set is the most natural encoding for a chess position. There is a one-to-one mapping between pieces in the board and features:

\begin{center}
    $\fs{Piece} = \fs{Square}_{p} \times \fs{Role}_{p} \times \fs{Color}_{p}$ \\
    for every $p$ piece in the board
\end{center}


%\begin{table}[h]
%\centering
%\begin{tabular}{ccccc}
%\pieceBoard & $\bigtimes$ & \pieceRolesTable & %$\bigtimes$ & \pieceColorsTable \\
%\end{tabular}
%\caption{some caption}
%\end{table}


$\langle piece\_square, piece\_type, piece\_color \rangle$

$64*6*2=768$ features


\subsection{\mdseries\fs{Compact}}

This is one of the simplest feature sets.

$\langle piece\_rank, piece\_type, piece\_color \rangle \oplus \langle piece\_file, piece\_type, piece\_color \rangle$

$(8*6*2)*2=192$ features

\subsection{\mdseries\fs{Piece+Moves}}

\fs{HalfP} $\oplus \langle move\_from, move\_to \rangle$

$768 + 64*64=4864$ features

Not friendly to efficiently update the network. It is almost always better to do a full refresh on eval.

\subsection{\mdseries\fs{Half-King-Piece}}

$\fs{King-Piece} = \fs{Square}_{K} \times \fs{Piece}_{P}$ where $K$ is the king to move and $P$ is any \textit{non-king} piece

$\langle side\_king\_square, piece\_square, piece\_type, piece\_color \rangle$ excl. king

$64*64*5*2=40960$ features

There are variations to this feature set, such as \fs{HalfKAv2} or notably \fs{HalfKAv2\_hm} that is currently the latest feature set used by Stockfish 16.1. I will not consider them in this work.

known as "KP" in the literature

if we skip the king, you may be thinking where does it get the information about the other king's side, .... blabla arquitectura Half

\subsection{\mdseries\fs{Half-Relative(H$|$V$|$HV)King-Piece}}


$\langle side\_king\_file - piece\_file + 7, side\_king\_rank - piece\_rank + 7, piece\_type, piece\_color \rangle$ excl. king

$15*15*5*2=2250$ features (for HV)

only H or only V have $8*15*5*2=1200$ features


\subsection{\mdseries\fs{Half-Top(PP)}}

Statistical feature set, blabla, wasted features blabla


\subsection{Recap}

\begin{table}[h]
\centering
\begin{tabular}{|l|c|c|c|c|}
\hline
Feature set & Tuple & \# features \\
\hline
\fs{Piece} & $\fs{Square}_{P} \times \fs{Role}_{P} \times \fs{Color}_{P}$ & 768  \\
\fs{Compact} & asd & 192  \\
\fs{Piece+Moves} & asd & 4864 \\
\fs{King-Piece} & asd & 40,960 \\
\fs{RelativeHV-King-Piece} & asd & 2250  \\
\fs{TopPP} & asd & 64  \\
\hline
\end{tabular}
\caption{Comparison of feature sets}
\end{table}
